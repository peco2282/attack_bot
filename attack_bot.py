from math import ceil
import discord
import asyncio

from discord import message
client = discord.Client()

osdict = {
    0:1.09,
    1:1.18,
    2:1.27,
    3:1.36,
    4:1.45,
    5:1.54,
    6:1.63,
    7:1.72,
    8:1.81,
    9:1.90,
    10:2.02659,
    11:2.15072,
    12:2.22172,
    13:2.26701,
    14:2.29829,
    15:2.32114,
    16:2.33856,
    17:2.35227,
    18:2.36334,
    19:2.37246,
    20:2.38011,
    21:2.38611,
    22:2.39221,
    23:2.39707,
    24:2.40135,
    25:2.40513,
    26:2.40849,
    27:2.41151,
    28:2.41424,
    29:2.4167,
    30:2.41895,
    31:2.421,
    32:2.42289,
    33:2.42462,
    34:2.42623,
    35:2.42772,
    36:2.4291,
    37:2.43039,
    38:2.43159,
    39:2.43272,
    40:2.43377,
    41:2.443476,
    42:2.4357,
    43:2.43658,
    44:2.43742,
    45:2.43821,
    46:2.43895,
    47:2.43966,
    48:2.44034,
    49:2.44098,
    50:2.44159,
    51:2.44217,
    52:2.44273,
    53:2.44326,
    54:2.44377,
    55:2.44426,
    56:2.44473,
    57:2.44518,
    58:2.44561,
    59:2.44602,
    60:2.44642
    }


'''
    else:
        await message.channel.send(f"„Åô„Åø„Åæ„Åõ„Çì„Åæ„Å†‰ΩúÊàê‰∏≠„Åß„Åô")
        os_power = 1.0
        return os_power
'''
async def tokkoulist(message, dmg, os_power, tokkou):
    if len(tokkou) == 0:
        dmg_all = dmg * os_power
        return dmg_all

    elif 1 <= len(tokkou) <= 5:
        tokkou_list = list(set(tokkou))
        tokkou_add = 1.0
        alpha = 0

        if len(tokkou) != len(tokkou_list):
            print("$")
            await message.channel.send(f"{message.author.mention}, ÈáçË§á„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ")

        elif ((str("4_5") in tokkou) and (str("5") in tokkou)):
            await message.channel.send(f"{message.author.mention}, 4_5„Å®5„ÅØÂêåÊôÇ„Å´Ë£ÖÁùÄ„Åß„Åç„Åæ„Åõ„Çì")

        elif ((str('4_5') in tokkou) and (str('leg') in tokkou)):
            await message.channel.send(f"{message.author.mention}, 4_5„Å®LEGENDÁü≥„ÅØÂêåÊôÇ„Å´Ë£ÖÁùÄ„Åß„Åç„Åæ„Åõ„Çì")

        elif ((str('leg') in tokkou) and (str('5') in tokkou)):
            await message.channel.send(f"{message.author.mention}, 5„Å®LEGENDÁü≥„ÅØÂêåÊôÇ„Å´Ë£ÖÁùÄ„Åß„Åç„Åæ„Åõ„Çì")

        else:
            if str('1') in tokkou:
                tokkou_add *= 1.1

            if str('2') in tokkou:
                tokkou_add *= 1.15

            if str('3') in tokkou:
                tokkou_add *= 1.23

            if str('4') in tokkou:
                tokkou_add *= 1.35

            if str('4_5' or '4.5') in tokkou:
                tokkou_add *= 1.40

            if str('5') in tokkou:
                tokkou_add *= 1.55

            if (str('leg') or str('LEG')) in tokkou:
                alpha = (dmg * 0.06)
                tokkou_add *= 1.55

                #####
            alldmg = dmg * os_power * tokkou_add + alpha
            return alldmg


async def thumb(message: discord.Message):
    channel = message.channel
    await channel.send('Send me that üëç reaction, mate')

    def check(reaction, user):
        return user == message.author and str(reaction.emoji) == 'üëç'

    try:
        reaction, user = await client.wait_for('reaction_add', timeout=60.0, check=check)
    except asyncio.TimeoutError:
        await channel.send('üëé')
    else:
        await channel.send('üëç')



@client.event
async def on_message_delete(message):
    print(message)

@client.event
async def on_ready():
    print(f'Logged in as: {client.user.name}')
    print(f'With ID: {client.user.id}')


@client.event
async def on_member_join(member: discord.Member):
    channel = member.guild.system_channel
    await channel.send(f"{member.mention},„Åì„Çì„Å´„Å°„ÅØ")
    await channel.send(f"ÂàÜ„Åã„Çâ„Å™„ÅÑ„Åì„Å®„Åå„ÅÇ„Çå„Å∞„ÄÅ`.help` „Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")

@client.event
async def on_message(message: discord.Message):
    
    if message.content.startswith(".dmg"):
        msg = message.content.split()
        dmg = float(msg[1])
        os = int(msg[2])
        tokkou = msg[3:]
        os_power = osdict[os]
        attack = await tokkoulist(message, dmg, os_power, tokkou)
        async with message.channel.typing():
            # simulate something heavy
            await asyncio.sleep(0.5)
            await message.channel.send(f"Á¥†ÁÅ´ÂäõÔºö{dmg}\nOS={os} \nÁâπÊîªÔºö{tokkou} \n__**ÊîªÊíÉÂäõÔºö{attack:.3f}**__")
        
        

   
        

# „ÇΩ„É´„Ç∏„É£„Éº„Éª„Ç¢„Éº„Çµ„Éº„Éª„Éû„Ç∏„Ç∑„É£„É≥
    if message.content.startswith(".job1"):
        msg_job = message.content.split()
        job = str(msg_job[1])  # ËÅ∑Ê•≠
        dmg = float(msg_job[2])
        os = int(msg_job[3])
        tokkou = msg_job[4:]
        job_1 = ''
        os_power = osdict[os]
        attack = await tokkoulist(message, dmg, os_power, tokkou)
        a = float(attack) * 1.05
        b = float(attack) * 0.98
        if str(job) == 's':
            job_1 = '„ÇΩ„É´„Ç∏„É£„Éº'
        elif str(job) == 'a':
            job_1 = '„Ç¢„Éº„ÉÅ„É£„Éº'
        elif str(job) == 'm':
            job_1 = '„Éû„Ç∏„Ç∑„É£„É≥'
        await message.channel.send(f"ËÅ∑Ê•≠Ôºö{job_1}\nOS={os}\nÁâπÊîªÔºö{tokkou}")
        if job == str('s'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö+5%: {a:.3f}, ÂºìÔºö-2%: {b:.3f}, È≠îÊ≥ïÔºö-2%: {b:.3f}**__")

        elif job == str('a'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-2%: {b:.3f}, ÂºìÔºö+5%: {a:.3f}, È≠îÊ≥ïÔºö-2%: {b:.3f}**__")

        elif job == str('m'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-2%: {b:.3f}, ÂºìÔºö-2%: {b:.3f}, È≠îÊ≥ïÔºö+5%: {a:.3f}**__")

# „Ç¶„Ç©„Éº„É™„Ç¢„Éª„Éú„Ç¶„Éû„É≥„Éª„É°„Ç§„Ç∏
    if message.content.startswith(".job2"):
        msg_job = message.content.split()
        job = str(msg_job[1])  # ËÅ∑Ê•≠
        dmg = float(msg_job[2])
        os = int(msg_job[3])
        tokkou = msg_job[4:]
        job_2 = ''
        os_power = osdict[os]
        attack = await tokkoulist(message, dmg, os_power, tokkou)
        a = float(attack) * 1.10
        b = float(attack) * 0.95
        if str(job) == 'w':
            job_2 = '„Ç¶„Ç©„Éº„É™„Ç¢'
        elif str(job) == 'b':
            job_2 = '„Éú„Ç¶„Éû„É≥'
        elif str(job) == 'm':
            job_2 = '„É°„Ç§„Ç∏'
        await message.channel.send(f"ËÅ∑Ê•≠Ôºö{job_2}\nOS={os}\nÁâπÊîªÔºö{tokkou}")
        if job == str('w'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö+10%: {a:.3f}, ÂºìÔºö-5%: {b:.3f}, È≠îÊ≥ïÔºö-5%: {b:.3f}**__")

        elif job == str('b'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-5%: {b:.3f}, ÂºìÔºö+10%: {a:.3f}, È≠îÊ≥ïÔºö-5%: {b:.3f}**__")

        elif job == str('m'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-5%: {b:.3f}, ÂºìÔºö-5%: {b:.3f}, È≠îÊ≥ïÔºö+10%: {a:.3f}**__")

# „É≠„Ç¶„Éã„É≥„Éª„Éâ„É©„Ç¥„É≥„Ç≠„É©„Éº„Éª„Éó„É™„Éº„Çπ„Éà„Éª„Çπ„Ç´„Éº„Éü„ÉÉ„Ç∑„É£„Éº
    if message.content.startswith(".job3"):
        msg_job = message.content.split()
        job = str(msg_job[1])  # ËÅ∑Ê•≠
        dmg = float(msg_job[2])
        os = int(msg_job[3])
        tokkou = msg_job[4:]
        job_3 = ''
        os_power = osdict[os]
        attack = await tokkoulist(message, dmg, os_power, tokkou)
        if str(job) == 'r':
            job_3 = '„É≠„Ç¶„Éã„É≥'
        elif str(job) == 'd':
            job_3 = '„Éâ„É©„Ç¥„É≥„Ç≠„É©„Éº'
        elif str(job) == 'p':
            job_3 = '„Éó„É™„Éº„Çπ„Éà'
        elif str(job) == 's':
            job_3 = '„Çπ„Ç´„Éº„Éü„ÉÉ„Ç∑„É£„Éº'
        await message.channel.send(f"ËÅ∑Ê•≠Ôºö{job_3}\nOS={os}\nÁâπÊîªÔºö{tokkou}")
        if job == str('r'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-4%: {float(attack * 0.96):.3f}, ÂºìÔºö-4%: {float(attack * 0.96):.3f}, È≠îÊ≥ïÔºö-4%: {float(attack * 0.96):.3f}**__")

        elif job == str('d'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-2%: {float(attack * 0.98):.3f}, ÂºìÔºö+5%: {float(attack * 1.05):.3f}, È≠îÊ≥ïÔºö-2%: {float(attack * 0.98):.3f}**__")

        elif job == str('p'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-10%: {float(attack * 0.90):.3f}, ÂºìÔºö-10%: {float(attack * 0.90):.3f}, È≠îÊ≥ïÔºö-10%: {float(attack * 0.90):.3f}**__")

        elif job == str('s'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö+5%: {float(attack * 1.05):.3f}, ÂºìÔºö{float(attack):.3f}, È≠îÊ≥ïÔºö{float(attack):.3f}**__")

# „Éè„Ç∞„É¨„É¢„Éé„Éª„É´„Éº„É≥„Ç≠„É£„Çπ„Çø„Éº„Éª„Çπ„Éö„É©„É≥„Ç´„Éº„Éª„Ç¢„Éº„Çµ„Éº„Éª„Ç∑„Éº„Ç´„Éº
    if message.content.startswith(".job4"):
        msg_job = message.content.split()
        job = str(msg_job[1])  # ËÅ∑Ê•≠
        dmg = float(msg_job[2])
        os = int(msg_job[3])
        tokkou = msg_job[4:]
        job_4 = ''
        os_power = osdict[os]
        attack = await tokkoulist(message, dmg, os_power, tokkou)
        if str(job) == 'h':
            job_4 = '„Éè„Ç∞„É¨„É¢„Éé'
        elif str(job) == 'r':
            job_4 = '„É´„Éº„É≥„Ç≠„É£„Çπ„Çø„Éº'
        elif str(job) == 'sp':
            job_4 = '„Çπ„Éö„É©„É≥„Ç´„Éº'
        elif str(job) == 'a':
            job_4 == '„Ç¢„Éº„Çµ„Éº'
        elif str(job) == 'se':
            job_4 == '„Ç∑„Éº„Ç´„Éº'
        await message.channel.send(f"ËÅ∑Ê•≠Ôºö{job_4}\nOS={os}\nÁâπÊîªÔºö{tokkou}")
        if job == str('h'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-7%: {float(attack * 0.93):.3f}, ÂºìÔºö-7%: {float(attack * 0.93):.3f}, È≠îÊ≥ïÔºö-7%: {float(attack * 0.93):.3f}**__")

        elif job == str('r'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-7%: {float(attack * 0.93):.3f}, ÂºìÔºö-7%: {float(attack * 0.93):.3f}, È≠îÊ≥ïÔºö+7%: {float(attack * 1.07):.3f}**__")

        elif job == str('sp'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö+10%: {float(attack * 1.10):.3f}, ÂºìÔºö+10%: {float(attack * 1.10):.3f}, È≠îÊ≥ïÔºö+10%: {float(attack * 1.10):.3f}**__")

        elif job == str('a'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö+5%: {float(attack * 1.05):.3f}, ÂºìÔºö{float(attack):.3f}, È≠îÊ≥ïÔºö{float(attack):.3f}**__")

        elif job == str('se'):
            await message.channel.send(f"__**ÊîªÊíÉÂäõÔºöÂâ£Ôºö-7%: {float(attack * 0.93):.3f}, ÂºìÔºö+10%: {float(attack * 1.10):.3f}, È≠îÊ≥ïÔºö-7%: {float(attack * 0.93):.3f}**__")

# „Ç≠„É£„Çπ„Çø„ÉºË®àÁÆó
    if message.content.startswith(".cas"):
        cas = message.content.split()
        ct = int(cas[1])
        ct_p = int(cas[2])
        cas_stones = cas[3:]
        ct_perk = 1
        cas_stone = 1

        if 1 == ct_p:
            ct_perk = 0.95

        elif 2 == ct_p:
            ct_perk = 0.90

        elif 3 == ct_p:
            ct_perk = 0.85

        elif 4 == ct_p:
            ct_perk = 0.80

        elif 5 == ct_p:
            ct_perk = 0.75

        elif 6 == ct_p:
            ct_perk = 0.70

        elif 7 == ct_p:
            ct_perk = 0.65

        elif 8 == ct_p:
            ct_perk = 0.60

        elif 9 == ct_p:
            ct_perk = 0.55

        elif 10 == ct_p:
            ct_perk = 0.50

        if 1 <= len(cas_stones) <= 5:

            if len(cas_stones) != len(list(set(cas_stones))):
                print("$")
                await message.channel.send(f"{message.author.mention}, ÈáçË§á„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ")

            if str('1') in cas_stones:
                cas_stone *= 0.95

            if str('2') in cas_stones:
                cas_stone *= 0.90

            if str('3') in cas_stones:
                cas_stone *= 0.84

            if str('4') in cas_stones:
                cas_stone *= 0.77

            if (str('4_5') or str('4.5')) in cas_stones:
                cas_stone *= 0.72

            if str('5') in cas_stones:
                cas_stone *= 0.60

        cas_all = float(ct * ct_perk * cas_stone)
        await message.channel.send(f"ÂÖÉ„ÅÆCTÔºö{str(ct)}\nCTPerkÔºö{str(ct_perk)}\nÈ≠îÊ≥ïÁü≥Ôºö{str(cas_stones)}\n__**CTÔºö{cas_all}**__")

    if message.content.startswith(".ask"):
        msg = message.content.split()
        wantdmg = float(msg[1])
        dmg = msg[2]
        os= msg[3]
        tokkou=msg[4:]
        
        if dmg == '?': # Dmg‰∏çÊòé
            dmg = 1.0
            os = int(os)
            os_power = osdict[os]
            attack = await tokkoulist(message, dmg, os_power, tokkou)
            dmg = wantdmg / attack
            await message.channel.send(f"OSÔºö{os}„ÅÆÊôÇ\n{wantdmg}„ÇíÂá∫„Åô„Å´„ÅØÊúÄ‰Ωé„Åß„ÇÇÁÅ´Âäõ„Åå__**{dmg:.3f}**__„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ")

        
        if os == '?': # OS‰∏çÊòé
            dmg = float(msg[2])
            os_power = 1.0
            # os_power = await oslist(message, os)

            attack = await tokkoulist(message, dmg, os_power, tokkou)
            # osÊØîËºÉ
            xOS = wantdmg / attack
            await message.channel.send(f"{xOS}ÂÄç")
            i = 1
            while xOS >= osdict[i]:
                i += 1
                if i >= len(osdict):
                    i = None
                    break
            if i == None:
                await message.channel.send(f"OS„Åå61‰ª•‰∏äÂøÖË¶Å„ÄÅÂèà„ÅØ‰∏çÂèØËÉΩ„Å™ÂÄ§„Åß„Åô„ÄÇ")
            else:
                await message.channel.send(f"{dmg}„Åß{wantdmg}„ÇíÂá∫„Åô„Å´„ÅØ\n__**OS„ÅØ{i}‰ª•‰∏ä**__„Å®„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")  

    if message.content.startswith(".help1"):
        embed = discord.Embed(title="„Ç≥„Éû„É≥„Éâ‰∏ÄË¶ß", color=discord.Colour.gold())
        embed.add_field(name='„Éò„É´„Éó', value='.help', inline=False)
        embed.add_field(
            name='„ÉÄ„É°„Éº„Ç∏Ë®àÁÆó', value='.dmg [ÊîªÊíÉÂäõ] [OS] [È≠îÊ≥ïÁü≥(1~5, „Åü„Å†„Åó4_5, 5, LEG„ÅØÈáçË§á‰∏çÂèØ)]', inline=False)
        embed.add_field(
            name='ËÅ∑Ê•≠Ëæº„Åø„Åß„ÅÆ„ÉÄ„É°„Éº„Ç∏Ë®àÁÆó', value='.job(1~4) [ËÅ∑Ê•≠] [ÊîªÊíÉÂäõ] [OS] [È≠îÊ≥ïÁü≥(1~5, „Åü„Å†„Åó4_5„Å®5„ÅØÈáçË§á‰∏çÂèØ)]', inline=False)
        embed.add_field(name='ËÅ∑Ê•≠[.job1]„Å´„Å§„ÅÑ„Å¶',
                        value='„ÇΩ„É´„Ç∏„É£„Éº:s, „Ç¢„Éº„ÉÅ„É£„Éº:a, „Éû„Ç∏„Ç∑„É£„É≥:m', inline=False)
        embed.add_field(name='ËÅ∑Ê•≠[.job2]„Å´„Å§„ÅÑ„Å¶',
                        value='„Ç¶„Ç©„Éº„É™„Ç¢:w, „Éú„Ç¶„Éû„É≥:b, „É°„Ç§„Ç∏:m', inline=False)
        embed.add_field(
            name='ËÅ∑Ê•≠[.job3]„Å´„Å§„ÅÑ„Å¶', value='„É≠„Ç¶„Éã„É≥:r, „Éâ„É©„Ç¥„É≥„Ç≠„É©„Éº:d, „Éó„É™„Éº„Çπ„Éà:p, „Çπ„Ç´„Éº„Éü„ÉÉ„Ç∑„É£„Éº:s', inline=False)
        embed.add_field(
            name='ËÅ∑Ê•≠[.job4]„Å´„Å§„ÅÑ„Å¶', value='„Éè„Ç∞„É¨„É¢„Éé:h, „É´„Éº„É≥„Ç≠„É£„Çπ„Çø„Éº:r, „Çπ„Éö„É©„É≥„Ç´„Éº:sp, „Ç¢„Éº„Çµ„Éº:a, „Ç∑„Éº„Ç´„Éº:se', inline=False)
        

        await message.channel.send(embed=embed)
    
    if message.content.startswith(".help2"):
        embed = discord.Embed(title="„Ç≥„Éû„É≥„Éâ‰∏ÄË¶ß", color=discord.Colour.lighter_gray())
        embed.add_field(
            name='„Ç≠„É£„Çπ„Çø„Éº', value='.cas [CT] [CTPerk] [È≠îÊ≥ïÁü≥(1 ~ 5)]', inline=False)
        embed.add_field(name='ÊúÄ‰ΩéOS„ÇíÊ±Ç„ÇÅ„ÇãÂ†¥Âêà', value='.ask [Ê¨≤„Åó„ÅÑÁÅ´Âäõ] [‰ªä„ÅÆÁ¥†„ÉÄ„É°] ? [È≠îÊ≥ïÁü≥]', inline=False)
        embed.add_field(name='ÊúÄ‰ΩéÁÅ´Âäõ„ÇíÊ±Ç„ÇÅ„ÇãÂ†¥Âêà', value='.ask [Ê¨≤„Åó„ÅÑÁÅ´Âäõ] ? [OS] [È≠îÊ≥ïÁü≥]', inline=False)

        await message.channel.send(embed=embed)
    
client.run('ODg0OTg2ODY2MjIxMzI2MzQ3.YTgePw.jvxLNGUcSseqwjKRcssHSM8SooY')
